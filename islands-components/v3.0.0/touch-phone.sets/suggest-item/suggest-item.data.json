{
  "name": "suggest-item",
  "elems": [
    {
      "name": "answer",
      "title": [
        {
          "level": "common.blocks",
          "tech": "title.txt",
          "content": "Группа элементов «Быстрый ответ»\n"
        }
      ]
    },
    {
      "name": "icon",
      "mods": [
        {
          "name": "traffic",
          "title": [
            {
              "level": "common.blocks",
              "tech": "title.txt",
              "content": "Иконки пробок\n"
            }
          ]
        },
        {
          "name": "weather",
          "title": [
            {
              "level": "common.blocks",
              "tech": "title.txt",
              "content": "Иконки погоды\n"
            }
          ]
        }
      ],
      "description": [
        {
          "level": "common.blocks",
          "tech": "desc.md",
          "content": "<p>Иконки лежат на блоке suggest-item временно. В будущем иконки будут\nвынесены в библиотеку islands-icons.</p>\n"
        }
      ],
      "title": [
        {
          "level": "common.blocks",
          "tech": "title.txt",
          "content": "Иконки\n"
        }
      ]
    }
  ],
  "mods": [
    {
      "name": "type",
      "vals": [
        {
          "name": "fact",
          "title": [
            {
              "level": "common.blocks",
              "tech": "title.txt",
              "content": "Факт\n"
            }
          ]
        },
        {
          "name": "nav",
          "title": [
            {
              "level": "common.blocks",
              "tech": "title.txt",
              "content": "Сайт\n"
            }
          ]
        },
        {
          "name": "text",
          "title": [
            {
              "level": "common.blocks",
              "tech": "title.txt",
              "content": "Подсказка\n"
            }
          ]
        },
        {
          "name": "traffic",
          "title": [
            {
              "level": "common.blocks",
              "tech": "title.txt",
              "content": "Пробки\n"
            }
          ]
        },
        {
          "name": "weather",
          "title": [
            {
              "level": "common.blocks",
              "tech": "title.txt",
              "content": "Погода\n"
            }
          ]
        }
      ],
      "title": [
        {
          "level": "common.blocks",
          "tech": "title.txt",
          "content": "Тип подсказки\n"
        }
      ]
    }
  ],
  "title": [
    {
      "level": "common.blocks",
      "tech": "title.txt",
      "content": "Элемент поисковой подсказки\n"
    }
  ],
  "description": [
    {
      "level": "common.blocks",
      "tech": "desc.md",
      "content": "<h2 id=\"-\">Описание</h2>\n<p>Блок <code>suggest-item</code> – элемент поисковой подсказки.</p>\n<p>Представляет собой элемент списка (строку) во всплывающем окне поисковой подсказки (блок <a href=\"../suggest/suggest.html\">suggest</a>), которое появляется после начала ввода пользователем запроса в поисковом поле.</p>\n<p>Блок <code>suggest-item</code> используется блоком <code>suggest</code>, и в отрыве от него применение не предполагается.</p>\n<h3 id=\"-\">Создание подсказок</h3>\n<p>Подсказки создаются на клиенте (в браузере).\nЗадача саджеста – показать всплывающее окно с подсказками.</p>\n<h4 id=\"-\">Формирование подсказок</h4>\n<p>Саджест формирует подсказки в несколько этапов:</p>\n<ul>\n<li>получает данные с сервера (событие саджеста <code>data-received</code>).</li>\n<li>строит BEMJSON-дерево (в статическом методе <code>_buildItems</code> саджеста), которое содержит только подсказки, без информации про <a href=\"../popup/popup.html\">popup</a> и само окно.</li>\n<li>BEMHTML-шаблон преобразует полученное дерево в HTML-строку.</li>\n</ul>\n<p>Подсказки бывают разных типов: простая текстовая, навигационная, «погода», «пробки» и др. - строятся они по-разному. Каким образом – определено в <a href=\"#mods\">модификаторе <code>type</code></a> блока <code>suggest-item</code>.</p>\n<h4 id=\"bemjson-\">BEMJSON элементов подсказки</h4>\n<p>Для каждой конкретной подсказки в саджесте создаётся подобный BEMJSON:</p>\n<pre><code class=\"lang-javascript\">{\n    block: &#39;suggest-item&#39;,\n    mods: {type: &#39;тип подсказки {String}&#39;},\n    data: второй элемент массива из ответа сервера {String|Array},\n    ключ: значение\n}</code></pre>\n<h4 id=\"-\">Поля блока</h4>\n<p><a name=\"mods\"></a></p>\n<ul>\n<li><p><code>{Object} mods</code> – модификаторы блока.</p>\n<ul>\n<li><code>{String} type</code> – типы подсказок. Допустимые значения:<ul>\n<li><code>fact</code> – факты. С ответами в подсказке.</li>\n<li><code>nav</code> –  сайт. Навигационные подсказки. По ним сразу можно перейти на сайт, не обращаясь к результатам поиска.</li>\n<li><code>text</code> – поиск. Обычные текстовые подсказки.</li>\n<li><code>traffic</code> – пробки. С колдунщиком трафика. Расширенный ответ может включать текст пробки (стрелка вниз/стрелка вверх), признак цвета светофора на иконке (элемент блока <code>icon</code> со значением <code>traffic</code>).</li>\n<li><code>weather</code> – погода. С колдунщиком погоды, может содержать текст температуры, иконку температуры ( элемент блока <code>icon</code> со значением <code>weather</code>).</li>\n</ul>\n</li>\n</ul>\n</li>\n<li><p><code>{Sring|Array} data</code> – значение подсказки.</p>\n<p>Сервер присылает ответ в виде массива следующего вида:</p>\n<pre><code>[\n  &#39;эхо запроса&#39;,\n  [ // массив с подсказками\n      &#39;простая текстовая подсказка&#39;,\n      [&#39;&#39;, &#39;простая текстовая подсказка через массив&#39;],\n      [&#39;weather&#39;, &#39;сложная подсказка, типа weather&#39;, {k: v}]\n  ],\n  {\n      глобальные: параметры\n  }\n]</code></pre>\n<p>В <code>data</code> передаётся значение для подсказки из массива подсказок (второй\nэлемент массива).\nПодробное описание типов можно посмотреть на странице <a href=\"http://wiki.yandex-team.ru/YandexMobile/Search/TechDocs/API/SearchSuggest\">поисковых подсказок</a>.</p>\n</li>\n<li><p><code>«ключ: значение»</code>. Если подсказка пришла в виде массива (сложная\nподсказка с некоторым типом), то последним элементом этого массива\n(массив 3-го уровня вложенности) может идти какой-то объект <code>{Object}</code>. Если\nэто действительно так (этот объект может и не прийти от сервера), то все\nключи примешиваются к BEMJSON вместе с соответствующими значениями.</p>\n<p>В параметрах каждой конкретной подсказки может прийти, например,\nинформация о том, что подсказка — персональная (человек уже вводил такой\nзапрос и Яндекс запомнил его; так называемые «Вы искали» или «Мои\nнаходки»). Тогда ответ сервера будет выглядеть как:</p>\n<pre><code>[\n  &#39;эхо запроса&#39;,\n  [\n      [&#39;&#39;, &#39;персональная подсказка&#39;, {pers: 1}]\n  ]\n]</code></pre>\n<p>BEMJSON, из которого саджест построит подсказки, будет выглядеть как:</p>\n<pre><code class=\"lang-js\">{\n  block: &#39;suggest-item&#39;,\n  mods: {type: &#39;text&#39;},\n  data: [&#39;&#39;, &#39;персональная подсказка&#39;, {pers: 1}],\n  pers: 1\n}</code></pre>\n</li>\n</ul>\n<p>Параметр <code>{pers: 1}</code> обрабатывается в шаблонах и добавляется в\nJS-параметры блока. То есть, если в параметрах блока есть <code>pers</code>, то\nподсказка персональная. Такая информация нужна для статистики\nиспользования саджеста.</p>\n<p>Кроме {pers: 1} в JS-параметры <code>suggest-item</code> попадает <code>cgi</code>. Значение его\nберётся из поля <code>search_cgi</code>, пришедшего в ответе сервера (в параметрах\nподсказки). Он тоже нужен для статистики.</p>\n<p>Еще в статистике используются данные, присланные сервером как\nглобальные параметры. Но это зона ответственности <code>suggest</code>, а не его\nэлементов, <code>suggest-item</code>.</p>\n<h4 id=\"-\">Группировка подсказок</h4>\n<p>Для разных платформ используются различные алгоритмы создания подсказок. Для планшета (touch-pad) и компьютера (desktop) создаются подсказки с группировкой (используется один код для обеих платформ). Для телефонов (touch-phone) – без группировок, простым списком.</p>\n<p>Саджест не меняет порядок следования подсказок, только иногда начинает новую группу. Алгоритм начала новой группы содержится в саджесте, хотя, предварительно, на сервере подсказки сортируются таким образом, чтобы сервер их мог правильно сгруппировать.</p>\n<h5 id=\"-\">Алгоритм группировки подсказок</h5>\n<p>На данный момент <strong>алгоритм группировки</strong> следующий:\nПодсказки одного типа, идущие подряд — образуют одну группу, подсказки с другим типом — другую, даже если в группе только одна подсказка.</p>\n<p>BEMJSON для группировки:</p>\n<pre><code class=\"lang-js\">{\n    block: &#39;suggest&#39;,\n    elem: &#39;group&#39;,\n    content: [\n        {elem: &#39;title&#39;, content: &#39;Заголовок группы&#39;},\n        {elem: &#39;items&#39;, content: [массив из suggest-item’ов]}\n    ]\n}</code></pre>\n<p><strong>Заголовок группы</strong> выводится в зависимости от языка. В саджесте определены\nзаголовки для стандартных типов. Локализованное значение заголовка определяется\nследующим образом:</p>\n<pre><code class=\"lang-js\">BEM.I18N(&#39;suggest&#39;, тип подсказки [&#39;text&#39;, &#39;nav&#39;, ...] {String})</code></pre>\n<p>При этом, для простой текстовой подсказки можно выбрать другой\nзаголовок. По умолчанию — это «Поиск», но, например, Я.Картинкам нужно\nустановить заголовок – «Картинки». Для установки существует глобальный параметр\n(в <a href=\"https://lego.yandex-team.ru/desktop/common/blocks/i-global\">i-global</a>), ключ которого — <code>suggest-label</code>. Получить значение можно, вызвав метод:</p>\n<pre><code class=\"lang-js\">BEM.blocks[&#39;i-global&#39;].param(&#39;suggest-label&#39;)</code></pre>\n<p>Если в результате получаем пустое значение, будет использовано значение по умолчанию.</p>\n<p><em><strong>Примечание:</strong> В Островах v2 название группы можно будет передать в JS-параметрах при определении блока <code>suggest</code> в BEMJSON</em>.</p>\n<h3 id=\"-\">Особенности реализации</h3>\n<ul>\n<li>В версии для телефона существуют свои особенности для подсказок. Все\nнюансы дизайна есть в <a href=\"http://wiki.yandex-team.ru/serp/thenewserp/dizajjn/touch.suggest\">спецификации для тач.саджеста touch.suggest</a>.\nНапример, для подсказки «Факт» нужно особым образом выравнивать текст\nподсказок, чтобы текст факта переходил на вторую строчку.</li>\n<li><code>suggest-item</code> экранирует (html escape) данные перед их добавлением на\nстраницу.</li>\n<li>Иконки «Пробок» хранятся рядом с <code>suggest-item</code>, а иконки «Погоды»\nберутся из одного хранилища сервиса. Планируется иконки «Пробок» перенести в библиотеку <code>islands-icons</code>.</li>\n<li>SVG используется везде, где можно. Где нельзя — PNG.</li>\n<li>Сервисы могут создавать свои типы подсказок.</li>\n</ul>\n"
    }
  ]
}